package UserInteractions;

import java.util.List;

import org.openqa.selenium.By;
import org.openqa.selenium.Keys;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.WebElement;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.support.ui.ExpectedConditions;
import org.openqa.selenium.support.ui.WebDriverWait;
import org.testng.Assert;

public class TikiLoginAndSearchTest {

    public static void main(String[] args) {
        // Thi·∫øt l·∫≠p WebDriver
        System.setProperty("webdriver.chrome.driver", "D:\\LeHoaiNam\\Selenium\\chromedriver.exe");
        WebDriver driver = new ChromeDriver();
        WebDriverWait wait = new WebDriverWait(driver, 10);

        try {
            // 1. M·ªü trang Tiki
            driver.get("https://tiki.vn/");
            driver.manage().window().maximize();
            WebElement closePopup = wait.until(ExpectedConditions.elementToBeClickable(By.cssSelector("button[class*='close'], button[data-view-id*='popup_close']")));
            closePopup.click();
            System.out.println("üîí ƒê√£ ƒë√≥ng popup.");

            // 2. Click v√†o n√∫t ƒêƒÉng nh·∫≠p
            WebElement loginButton = wait.until(ExpectedConditions.elementToBeClickable(By.cssSelector("span.userstyle__UserName-sc-6e6am-10"))); // c√≥ th·ªÉ thay ƒë·ªïi t√πy Tiki
            loginButton.click();

            // 3. Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i ho·∫∑c email
            WebElement phoneInput = wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//input[@name='email']")));
            phoneInput.sendKeys("0786990226");  // <-- Thay b·∫±ng t√†i kho·∫£n test

            // 4. Nh·∫•n ti·∫øp t·ª•c
            WebElement continueButton = driver.findElement(By.xpath("//button[@type='submit']"));
            continueButton.click();

            // 5. Nh·∫≠p m·∫≠t kh·∫©u
            WebElement passwordInput = wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//input[@type='password']")));
            passwordInput.sendKeys("Nam023432657."); // <-- Thay b·∫±ng m·∫≠t kh·∫©u test

            // 6. Nh·∫•n ƒêƒÉng nh·∫≠p
            WebElement loginSubmit = driver.findElement(By.xpath("//button[@type='submit']"));
            loginSubmit.click();

            // 7. Ch·ªù login th√†nh c√¥ng (c√≥ th·ªÉ ki·ªÉm tra user hi·ªÉn th·ªã)
            wait.until(ExpectedConditions.visibilityOfElementLocated(By.cssSelector("span.userstyle__UserName-sc-6e6am-10")));

            System.out.println("‚úÖ ƒêƒÉng nh·∫≠p th√†nh c√¥ng!");

            // 8. T√¨m ki·∫øm t·ª´ kh√≥a "iphone"
            String keyword = "iphone";
            WebElement searchBox = wait.until(ExpectedConditions.visibilityOfElementLocated(By.xpath("//input[@data-view-id='main_search_form_input']")));
            searchBox.sendKeys(keyword);
            searchBox.sendKeys(Keys.ENTER);

            // 9. Ch·ªù k·∫øt qu·∫£ hi·ªÉn th·ªã
            wait.until(ExpectedConditions.visibilityOfElementLocated(By.cssSelector("div.ProductList__Wrapper-sc-1dl80l3-0")));

            // 10. L·∫•y danh s√°ch s·∫£n ph·∫©m
            List<WebElement> results = driver.findElements(By.cssSelector("a.ProductItem__Name-sc-1f9hdu8-2")); // Tiki c√≥ th·ªÉ ƒë·ªïi class, n√™n ki·ªÉm tra k·ªπ b·∫±ng DevTools

            boolean isValid = true;

            for (WebElement result : results) {
                String productTitle = result.getText().toLowerCase();
                if (!productTitle.contains(keyword.toLowerCase())) {
                    isValid = false;
                    System.out.println("‚ùå S·∫£n ph·∫©m kh√¥ng li√™n quan: " + productTitle);
                }
            }

            Assert.assertTrue(isValid, "‚ùå M·ªôt ho·∫∑c nhi·ªÅu k·∫øt qu·∫£ kh√¥ng ch·ª©a t·ª´ kh√≥a t√¨m ki·∫øm!");
            System.out.println("‚úÖ T·∫•t c·∫£ s·∫£n ph·∫©m li√™n quan ƒë·∫øn t·ª´ kh√≥a t√¨m ki·∫øm.");

        } catch (Exception e) {
            e.printStackTrace();
        } finally {
            // 11. ƒê√≥ng tr√¨nh duy·ªát
            driver.quit();
        }
    }
}
